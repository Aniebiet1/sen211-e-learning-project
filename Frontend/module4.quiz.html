<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./../style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Afacad:ital,wght@0,400..700;1,400..700&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">
    <script defer>
        var quizState = 'wait'
        document.addEventListener("DOMContentLoaded", function () {
            const params = new URLSearchParams(window.location.search);
            const file = params.get('file');
            const waitSection = document.querySelector('.inside.embed.wait')
            const startSection = document.querySelector('.inside.embed.start')
            const finishSection = document.querySelector('.inside.embed.finish')
            const quizName = document.querySelector('.quiz-name')
            const startButton = document.querySelector('.go.start')
            const submitButton = document.querySelector('.go.submit')
            const statusMessage = document.querySelector('.status-message')
            const questionContainer = document.querySelector('.questions-container-main')

            if (file) {
                fetch(`./../content/${file}`)
                    .then(response => response.text())
                    .then(data => {
                        const quizData = JSON.parse(data)
                        console.log(quizData)
                        quizName.innerText = quizData.name
                        statusMessage.innerText = ""
                        const questionsContainer = document.createElement('div');
                        questionsContainer.classList.add('questions-container');

                        quizData.questions.forEach((questionData, index) => {
                            const questionElement = document.createElement('div');
                            questionElement.classList.add('question');

                            const questionText = document.createElement('p');
                            questionText.innerText = `${index + 1}. ${questionData.question}`;
                            questionElement.appendChild(questionText);

                            questionData.options.forEach((option, optionIndex) => {
                                const optionElement = document.createElement('div');
                                optionElement.classList.add('option');

                                const inputElement = document.createElement('input');
                                inputElement.type = 'radio';
                                inputElement.name = `question-${index}`;
                                inputElement.value = option;
                                inputElement.id = `question-${index}-option-${optionIndex}`;
                                optionElement.appendChild(inputElement);

                                const labelElement = document.createElement('label');
                                labelElement.innerText = option;
                                labelElement.htmlFor = `question-${index}-option-${optionIndex}`;
                                optionElement.appendChild(labelElement);

                                questionElement.appendChild(optionElement);
                            });

                            questionsContainer.appendChild(questionElement);
                        });

                        questionContainer.appendChild(questionsContainer);

                        submitButton.onclick = () => {
                            console.log("Submit")
                            startSection.classList.toggle('hide', true)
                            finishSection.classList.toggle('hide', false)

                            let score = 0;
                            const questions = document.querySelectorAll('.question');
                            questions.forEach((question, index) => {
                                const selectedOption = question.querySelector('input[type="radio"]:checked');
                                console.log(selectedOption)
                                if (selectedOption && selectedOption.value == quizData.questions[index].correct) {
                                    score++;
                                }
                            });

                            console.log("Final Score:", score);
                            document.querySelector('.score-show').innerText = `Your scored ${score}/${quizData.questions.length}`
                        }
                    })
                    .catch(error => console.error('Error fetching the file:', error));
            }
            else {
                console.warn("Dev: Pass a quiz data file to continue")
            }
            startButton.onclick = () => {
                console.log("Start")
                waitSection.classList.toggle('hide', true)
                startSection.classList.toggle('hide', false)
            }

        });
    </script>
    <title>Module 4 Quiz</title>
</head>

<body>
    <div class="main">
        <div class="header-section">
            <img src="./../res/module4.png" class="g4-logo" />
            <div class="user-slug">
                EM
            </div>
        </div>
        <p class="welcome-message">Welcome, Gideon Jones </p>
        <p><a href="./../index.html" class="goto">Home</a> /<a href="./module4.html" class="goto">Module 4</a>/Quiz</p>
        <span class="status-message">Loading ...</span>
        <div class="inside embed wait">
            <!-- Content will be loaded here -->
            <div class="inside-header start">
                <h1 class="quiz-name"></h1>
                <a class="link-part end go start">Start</a>
            </div>
        </div>
        <div class="inside embed start hide">
            <!-- Content will be loaded here -->
            <div class="questions-container-main">

            </div>
            <div class="inside-header-home start">
                <span>End of quiz</span>
                <a class="link-part end go submit">Submit</a>
            </div>
        </div>
        <div class="inside embed finish hide">
            <!-- Content will be loaded here -->
            <div class="final-score">
                <h1 class="score-show">Loading score</h1>
                <p>Review result</p>
            </div>
            <div class="inside-header-small start">
                <a class="link-part" onclick="location.reload()">Take again</a>
                <p><a href="./module4.html" class="goto">‚Üê Back to Module 4</a></p>
            </div>
        </div>
    </div>
</body>

</html>